--- a/net/minecraft/server/level/WorldGenRegion.java
+++ b/net/minecraft/server/level/WorldGenRegion.java
@@ -32,6 +_,7 @@
 import net.minecraft.world.item.ItemStack;
 import net.minecraft.world.level.ChunkPos;
 import net.minecraft.world.level.LevelHeightAccessor;
+import net.minecraft.world.level.LightLayer;
 import net.minecraft.world.level.WorldGenLevel;
 import net.minecraft.world.level.biome.Biome;
 import net.minecraft.world.level.biome.BiomeManager;
@@ -149,6 +_,20 @@
         return i < this.generatingStep.directDependencies().size();
     }
 
+    // Paper start - if loaded util
+    @Nullable
+    @Override
+    public ChunkAccess getChunkIfLoadedImmediately(int x, int z) {
+        return this.getChunk(x, z, ChunkStatus.FULL, false);
+    }
+
+    @Override
+    public final BlockState getBlockStateIfLoaded(BlockPos blockposition) {
+        ChunkAccess chunk = this.getChunkIfLoadedImmediately(blockposition.getX() >> 4, blockposition.getZ() >> 4);
+        return chunk == null ? null : chunk.getBlockState(blockposition);
+    }
+    // Paper end
+
     @Override
     public BlockState getBlockState(BlockPos p_9587_) {
         return this.getChunk(SectionPos.blockToSectionCoord(p_9587_.getX()), SectionPos.blockToSectionCoord(p_9587_.getZ())).getBlockState(p_9587_);
@@ -196,7 +_,7 @@
         if (blockstate.isAir()) {
             return false;
         } else {
-            if (p_9551_) {
+            if (false) { // CraftBukkit - SPIGOT-6833: Do not drop during world generation
                 BlockEntity blockentity = blockstate.hasBlockEntity() ? this.getBlockEntity(p_9550_) : null;
                 Block.dropResources(blockstate, this.level, p_9550_, blockentity, p_9552_, ItemStack.EMPTY);
             }
@@ -257,7 +_,7 @@
 
             return true;
         } else {
-            Util.logAndPauseIfInIde(
+            if (Boolean.valueOf(false)) Util.logAndPauseIfInIde(
                 "Detected setBlock in a far chunk ["
                     + i
                     + ", "
@@ -279,6 +_,7 @@
         } else {
             ChunkAccess chunkaccess = this.getChunk(p_9539_);
             BlockState blockstate = chunkaccess.setBlockState(p_9539_, p_9540_, false);
+            final BlockState previousBlockState = blockstate; // Paper - Clear block entity before setting up a DUMMY block entity - obfhelper
             if (blockstate != null) {
                 this.level.onBlockStateChange(p_9539_, blockstate, p_9540_);
             }
@@ -292,6 +_,17 @@
                         chunkaccess.removeBlockEntity(p_9539_);
                     }
                 } else {
+                    // Paper start - Clear block entity before setting up a DUMMY block entity
+                    // The concept of removing a block entity when the block itself changes is generally lifted
+                    // from LevelChunk#setBlockState.
+                    // It is however to note that this may only run if the block actually changes.
+                    // Otherwise a chest block entity generated by a structure template that is later "updated" to
+                    // be waterlogged would remove its existing block entity (see PaperMC/Paper#10750)
+                    // This logic is *also* found in LevelChunk#setBlockState.
+                    if (previousBlockState != null && !java.util.Objects.equals(previousBlockState.getBlock(), p_9540_.getBlock())) {
+                        chunkaccess.removeBlockEntity(p_9539_);
+                    }
+                    // Paper end - Clear block entity before setting up a DUMMY block entity
                     CompoundTag compoundtag = new CompoundTag();
                     compoundtag.putInt("x", p_9539_.getX());
                     compoundtag.putInt("y", p_9539_.getY());
@@ -317,6 +_,14 @@
 
     @Override
     public boolean addFreshEntity(Entity p_9580_) {
+        // CraftBukkit start
+        return addFreshEntity(p_9580_, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.DEFAULT);
+    }
+
+    @Override
+    public boolean addFreshEntity(Entity p_9580_, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason reason) {
+        // CraftBukkit end
+        if (p_9580_ instanceof net.minecraft.world.entity.Mob mob && mob.isSpawnCancelled()) return false;
         int i = SectionPos.blockToSectionCoord(p_9580_.getBlockX());
         int j = SectionPos.blockToSectionCoord(p_9580_.getBlockZ());
         this.getChunk(i, j).addEntity(p_9580_);
