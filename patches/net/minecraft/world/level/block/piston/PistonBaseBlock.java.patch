--- a/net/minecraft/world/level/block/piston/PistonBaseBlock.java
+++ b/net/minecraft/world/level/block/piston/PistonBaseBlock.java
@@ -2,10 +_,10 @@
 
 import com.google.common.collect.Lists;
 import com.google.common.collect.Maps;
+import com.mohistmc.youer.util.PaperUnsupportedSettings;
 import com.mojang.serialization.Codec;
 import com.mojang.serialization.MapCodec;
 import com.mojang.serialization.codecs.RecordCodecBuilder;
-import com.mojang.serialization.codecs.RecordCodecBuilder.Instance;
 import java.util.List;
 import java.util.Map;
 import java.util.Map.Entry;
@@ -39,6 +_,8 @@
 import net.minecraft.world.phys.shapes.CollisionContext;
 import net.minecraft.world.phys.shapes.Shapes;
 import net.minecraft.world.phys.shapes.VoxelShape;
+import org.bukkit.craftbukkit.block.CraftBlock;
+import org.bukkit.event.block.BlockPistonRetractEvent;
 
 public class PistonBaseBlock extends DirectionalBlock {
     public static final MapCodec<PistonBaseBlock> CODEC = RecordCodecBuilder.mapCodec(
@@ -186,6 +_,7 @@
         }
 
         if (p_60195_ == 0) {
+            if (net.neoforged.neoforge.event.EventHooks.onPistonMovePre(p_60193_, p_60194_, direction, true)) return false;
             if (!this.moveBlocks(p_60193_, p_60194_, direction, true)) {
                 return false;
             }
@@ -194,6 +_,7 @@
             p_60193_.playSound(null, p_60194_, SoundEvents.PISTON_EXTEND, SoundSource.BLOCKS, 0.5F, p_60193_.random.nextFloat() * 0.25F + 0.6F);
             p_60193_.gameEvent(GameEvent.BLOCK_ACTIVATE, p_60194_, GameEvent.Context.of(blockstate));
         } else if (p_60195_ == 1 || p_60195_ == 2) {
+            if (net.neoforged.neoforge.event.EventHooks.onPistonMovePre(p_60193_, p_60194_, direction, false)) return false;
             BlockEntity blockentity = p_60193_.getBlockEntity(p_60194_.relative(direction));
             if (blockentity instanceof PistonMovingBlockEntity) {
                 ((PistonMovingBlockEntity)blockentity).finalTick();
@@ -203,6 +_,14 @@
                 .defaultBlockState()
                 .setValue(MovingPistonBlock.FACING, direction)
                 .setValue(MovingPistonBlock.TYPE, this.isSticky ? PistonType.STICKY : PistonType.DEFAULT);
+
+            // Paper start - Fix sticky pistons and BlockPistonRetractEvent; Move empty piston retract call to fix multiple event fires
+            if (!this.isSticky) {
+                if (!new BlockPistonRetractEvent(CraftBlock.at(p_60193_, p_60194_), java.util.Collections.emptyList(), CraftBlock.notchToBlockFace(direction)).callEvent()) {
+                    return false;
+                }
+            }
+            // Paper end - Fix sticky pistons and BlockPistonRetractEvent
             p_60193_.setBlock(p_60194_, blockstate1, 20);
             p_60193_.setBlockEntity(
                 MovingPistonBlock.newMovingBlockEntity(
@@ -232,6 +_,13 @@
                             && !blockstate2.is(Blocks.STICKY_PISTON)) {
                         p_60193_.removeBlock(p_60194_.relative(direction), false);
                     } else {
+                        // Paper start - Fix sticky pistons and BlockPistonRetractEvent; fire BlockPistonRetractEvent for sticky pistons retracting nothing (air)
+                        if (p_60195_ == TRIGGER_CONTRACT && blockstate1.isAir()) {
+                            if (!new BlockPistonRetractEvent(CraftBlock.at(p_60193_, p_60194_), java.util.Collections.emptyList(), CraftBlock.notchToBlockFace(direction)).callEvent()) {
+                                return false;
+                            }
+                        }
+                        // Paper end - Fix sticky pistons and BlockPistonRetractEvent
                         this.moveBlocks(p_60193_, p_60194_, direction, false);
                     }
                 }
@@ -243,6 +_,7 @@
             p_60193_.gameEvent(GameEvent.BLOCK_DEACTIVATE, p_60194_, GameEvent.Context.of(blockstate1));
         }
 
+        net.neoforged.neoforge.event.EventHooks.onPistonMovePost(p_60193_, p_60194_, direction, (p_60195_ == 0));
         return true;
     }
 
@@ -309,13 +_,54 @@
             Direction direction = p_60185_ ? p_60184_ : p_60184_.getOpposite();
             int i = 0;
 
+            {
+                // CraftBukkit start
+                final org.bukkit.block.Block bblock = p_60182_.getWorld().getBlockAt(p_60183_.getX(), p_60183_.getY(), p_60183_.getZ());
+                final List<BlockPos> moved = pistonstructureresolver.getToPush();
+                final List<BlockPos> broken = pistonstructureresolver.getToDestroy();
+                List<org.bukkit.block.Block> blocks = new java.util.AbstractList<>() {
+                    @Override
+                    public int size() {
+                        return moved.size() + broken.size();
+                    }
+
+                    @Override
+                    public org.bukkit.block.Block get(int index) {
+                        if (index >= size() || index < 0) {
+                            throw new ArrayIndexOutOfBoundsException(index);
+                        }
+                        BlockPos pos = (BlockPos) (index < moved.size() ? moved.get(index) : broken.get(index - moved.size()));
+                        return bblock.getWorld().getBlockAt(pos.getX(), pos.getY(), pos.getZ());
+                    }
+                };
+                org.bukkit.event.block.BlockPistonEvent event;
+                if (p_60185_) {
+                    event = new org.bukkit.event.block.BlockPistonExtendEvent(bblock, blocks, CraftBlock.notchToBlockFace(direction));
+                } else {
+                    event = new org.bukkit.event.block.BlockPistonRetractEvent(bblock, blocks, CraftBlock.notchToBlockFace(direction));
+                }
+                p_60182_.getCraftServer().getPluginManager().callEvent(event);
+                if (event.isCancelled()) {
+                    for (BlockPos b : broken) {
+                        p_60182_.sendBlockUpdated(b, Blocks.AIR.defaultBlockState(), p_60182_.getBlockState(b), 3);
+                    }
+                    for (BlockPos b : moved) {
+                        p_60182_.sendBlockUpdated(b, Blocks.AIR.defaultBlockState(), p_60182_.getBlockState(b), 3);
+                        b = b.relative(direction);
+                        p_60182_.sendBlockUpdated(b, Blocks.AIR.defaultBlockState(), p_60182_.getBlockState(b), 3);
+                    }
+                    return false;
+                }
+                // CraftBukkit end
+            }
+
             for (int j = list2.size() - 1; j >= 0; j--) {
                 BlockPos blockpos2 = list2.get(j);
                 BlockState blockstate1 = p_60182_.getBlockState(blockpos2);
                 BlockEntity blockentity = blockstate1.hasBlockEntity() ? p_60182_.getBlockEntity(blockpos2) : null;
+                Block.dropResources$paperSource.set(p_60183_);  // Paper - Add BlockBreakBlockEvent
                 dropResources(blockstate1, p_60182_, blockpos2, blockentity);
-                p_60182_.setBlock(blockpos2, Blocks.AIR.defaultBlockState(), 18);
-                p_60182_.gameEvent(GameEvent.BLOCK_DESTROY, blockpos2, GameEvent.Context.of(blockstate1));
+                blockstate1.onDestroyedByPushReaction(p_60182_, blockpos2, direction, p_60182_.getFluidState(blockpos2));
                 if (!blockstate1.is(BlockTags.FIRE)) {
                     p_60182_.addDestroyBlockEffect(blockpos2, blockstate1);
                 }
@@ -326,11 +_,13 @@
             for (int k = list.size() - 1; k >= 0; k--) {
                 BlockPos blockpos3 = list.get(k);
                 BlockState blockstate5 = p_60182_.getBlockState(blockpos3);
+                PaperUnsupportedSettings.start_allowPistonDuplication(blockpos3, p_60182_); // Youer
                 blockpos3 = blockpos3.relative(direction);
                 map.remove(blockpos3);
                 BlockState blockstate8 = Blocks.MOVING_PISTON.defaultBlockState().setValue(FACING, p_60184_);
                 p_60182_.setBlock(blockpos3, blockstate8, 68);
                 p_60182_.setBlockEntity(MovingPistonBlock.newMovingBlockEntity(blockpos3, blockstate8, list1.get(k), p_60184_, p_60185_, false));
+                PaperUnsupportedSettings.end_allowPistonDuplication(blockpos3, list, k, p_60182_, map, blockstate8, list1, p_60184_, p_60185_); // Youer
                 ablockstate[i++] = blockstate5;
             }
 
@@ -387,6 +_,10 @@
     @Override
     protected BlockState rotate(BlockState p_60215_, Rotation p_60216_) {
         return p_60215_.setValue(FACING, p_60216_.rotate(p_60215_.getValue(FACING)));
+    }
+
+    public BlockState rotate(BlockState state, net.minecraft.world.level.LevelAccessor world, BlockPos pos, Rotation direction) {
+         return state.getValue(EXTENDED) ? state : super.rotate(state, world, pos, direction);
     }
 
     @Override
