--- a/net/minecraft/world/level/block/state/BlockBehaviour.java
+++ b/net/minecraft/world/level/block/state/BlockBehaviour.java
@@ -3,7 +_,6 @@
 import com.mojang.serialization.Codec;
 import com.mojang.serialization.MapCodec;
 import com.mojang.serialization.codecs.RecordCodecBuilder;
-import com.mojang.serialization.codecs.RecordCodecBuilder.Instance;
 import it.unimi.dsi.fastutil.objects.Reference2ObjectArrayMap;
 import java.util.Arrays;
 import java.util.Collections;
@@ -81,13 +_,14 @@
 import net.minecraft.world.phys.shapes.CollisionContext;
 import net.minecraft.world.phys.shapes.Shapes;
 import net.minecraft.world.phys.shapes.VoxelShape;
+import org.bukkit.craftbukkit.block.data.CraftBlockData;
 
 public abstract class BlockBehaviour implements FeatureElement {
     protected static final Direction[] UPDATE_SHAPE_ORDER = new Direction[]{
         Direction.WEST, Direction.EAST, Direction.NORTH, Direction.SOUTH, Direction.DOWN, Direction.UP
     };
-    protected final boolean hasCollision;
-    protected final float explosionResistance;
+    public final boolean hasCollision;
+    public float explosionResistance;
     protected final boolean isRandomlyTicking;
     protected final SoundType soundType;
     protected final float friction;
@@ -111,6 +_,17 @@
         this.dynamicShape = p_60452_.dynamicShape;
         this.requiredFeatures = p_60452_.requiredFeatures;
         this.properties = p_60452_;
+        final ResourceKey<LootTable> lootTableCache = p_60452_.drops;
+        if (lootTableCache != null) {
+            this.lootTableSupplier = () -> lootTableCache;
+        } else if (p_60452_.lootTableSupplier != null) {
+            this.lootTableSupplier = p_60452_.lootTableSupplier;
+        } else {
+            this.lootTableSupplier = () -> {
+                ResourceLocation resourcelocation = BuiltInRegistries.BLOCK.getKey(this.asBlock());
+                return ResourceKey.create(Registries.LOOT_TABLE, resourcelocation.withPrefix("blocks/"));
+            };
+        }
     }
 
     public BlockBehaviour.Properties properties() {
@@ -168,23 +_,24 @@
         if (!p_311951_.isAir() && p_312925_.getBlockInteraction() != Explosion.BlockInteraction.TRIGGER_BLOCK) {
             Block block = p_311951_.getBlock();
             boolean flag = p_312925_.getIndirectSourceEntity() instanceof Player;
-            if (block.dropFromExplosion(p_312925_) && p_312820_ instanceof ServerLevel serverlevel) {
+            if (p_311951_.canDropFromExplosion(p_312820_, p_312489_, p_312925_) && p_312820_ instanceof ServerLevel serverlevel) {
                 BlockEntity blockentity = p_311951_.hasBlockEntity() ? p_312820_.getBlockEntity(p_312489_) : null;
                 LootParams.Builder lootparams$builder = new LootParams.Builder(serverlevel)
                     .withParameter(LootContextParams.ORIGIN, Vec3.atCenterOf(p_312489_))
                     .withParameter(LootContextParams.TOOL, ItemStack.EMPTY)
                     .withOptionalParameter(LootContextParams.BLOCK_ENTITY, blockentity)
                     .withOptionalParameter(LootContextParams.THIS_ENTITY, p_312925_.getDirectSourceEntity());
-                if (p_312925_.getBlockInteraction() == Explosion.BlockInteraction.DESTROY_WITH_DECAY) {
-                    lootparams$builder.withParameter(LootContextParams.EXPLOSION_RADIUS, p_312925_.radius());
+                // CraftBukkit start - add yield
+                if (p_312925_.yield < 1.0F) {
+                    lootparams$builder.withParameter(LootContextParams.EXPLOSION_RADIUS, 1.0F / p_312925_.yield);
+                    // CraftBukkit end
                 }
 
                 p_311951_.spawnAfterBreak(serverlevel, p_312489_, ItemStack.EMPTY, flag);
                 p_311951_.getDrops(lootparams$builder).forEach(p_311752_ -> p_312073_.accept(p_311752_, p_312489_));
             }
 
-            p_312820_.setBlock(p_312489_, Blocks.AIR.defaultBlockState(), 3);
-            block.wasExploded(p_312820_, p_312489_, p_312925_);
+            p_311951_.onBlockExploded(p_312820_, p_312489_, p_312925_);
         }
     }
 
@@ -288,7 +_,7 @@
     }
 
     @Nullable
-    protected MenuProvider getMenuProvider(BlockState p_60563_, Level p_60564_, BlockPos p_60565_) {
+    public MenuProvider getMenuProvider(BlockState p_60563_, Level p_60564_, BlockPos p_60565_) {
         return null;
     }
 
@@ -335,8 +_,8 @@
         if (f == -1.0F) {
             return 0.0F;
         } else {
-            int i = p_60467_.hasCorrectToolForDrops(p_60466_) ? 30 : 100;
-            return p_60467_.getDestroySpeed(p_60466_) / f / (float)i;
+            int i = net.neoforged.neoforge.event.EventHooks.doPlayerHarvestCheck(p_60467_, p_60466_, p_60468_, p_60469_) ? 30 : 100;
+            return p_60467_.getDigSpeed(p_60466_, p_60469_) / f / (float)i;
         }
     }
 
@@ -359,8 +_,7 @@
 
     public final ResourceKey<LootTable> getLootTable() {
         if (this.drops == null) {
-            ResourceLocation resourcelocation = BuiltInRegistries.BLOCK.getKey(this.asBlock());
-            this.drops = ResourceKey.create(Registries.LOOT_TABLE, resourcelocation.withPrefix("blocks/"));
+            this.drops = this.lootTableSupplier.get();
         }
 
         return this.drops;
@@ -377,6 +_,7 @@
         return this.isRandomlyTicking;
     }
 
+    @Deprecated //Forge: Use more sensitive version {@link IForgeBlockState#getSoundType(IWorldReader, BlockPos, Entity) }
     protected SoundType getSoundType(BlockState p_320941_) {
         return this.soundType;
     }
@@ -393,6 +_,13 @@
         return this.properties.destroyTime;
     }
 
+    protected boolean isAir(BlockState state) {
+        return ((BlockStateBase)state).isAir;
+    }
+
+    // Neo: Holds the loot table for this block's drops. Used for getLootTable method.
+    private final java.util.function.Supplier<ResourceKey<LootTable>> lootTableSupplier;
+
     public abstract static class BlockStateBase extends StateHolder<Block, BlockState> {
         private final int lightEmission;
         private final boolean useShapeForLightOcclusion;
@@ -421,6 +_,7 @@
         protected BlockBehaviour.BlockStateBase.Cache cache;
         private FluidState fluidState = Fluids.EMPTY.defaultFluidState();
         private boolean isRandomlyTicking;
+        private boolean isConditionallyFullOpaque;
 
         protected BlockStateBase(Block p_60608_, Reference2ObjectArrayMap<Property<?>, Comparable<?>> p_326208_, MapCodec<BlockState> p_60610_) {
             super(p_60608_, p_326208_, p_60610_);
@@ -446,6 +_,16 @@
             this.replaceable = blockbehaviour$properties.replaceable;
         }
 
+        // Paper start - Perf: impl cached craft block data, lazy load to fix issue with loading at the wrong time
+        private CraftBlockData cachedCraftBlockData;
+
+        public CraftBlockData createCraftBlockData() {
+            if (cachedCraftBlockData == null) cachedCraftBlockData = CraftBlockData.createData(asState());
+            return (CraftBlockData) cachedCraftBlockData.clone();
+        }
+        // Paper end - Perf: impl cached craft block data, lazy load to fix issue with loading at the wrong time
+
+
         private boolean calculateSolid() {
             if (this.owner.properties.forceSolidOn) {
                 return true;
@@ -472,6 +_,7 @@
             }
 
             this.legacySolid = this.calculateSolid();
+            this.isConditionallyFullOpaque = this.canOcclude & this.useShapeForLightOcclusion;
         }
 
         public Block getBlock() {
@@ -523,14 +_,18 @@
             return this.useShapeForLightOcclusion;
         }
 
+        /** @deprecated Forge: Use {@link BlockState#getLightEmission(BlockGetter, BlockPos)} instead */
+        @Deprecated
         public int getLightEmission() {
             return this.lightEmission;
         }
 
         public boolean isAir() {
-            return this.isAir;
+            return this.getBlock().isAir((BlockState)this);
         }
 
+        /** @deprecated Neo: Use {@link net.neoforged.neoforge.common.extensions.IBlockStateExtension#ignitedByLava(BlockGetter, BlockPos, Direction)} instead */
+        @Deprecated
         public boolean ignitedByLava() {
             return this.ignitedByLava;
         }
@@ -541,9 +_,11 @@
         }
 
         public MapColor getMapColor(BlockGetter p_285002_, BlockPos p_285293_) {
-            return this.mapColor;
+            return getBlock().getMapColor(this.asState(), p_285002_, p_285293_, this.mapColor);
         }
 
+        /** @deprecated use {@link BlockState#rotate(LevelAccessor, BlockPos, Rotation)} */
+        @Deprecated
         public BlockState rotate(Rotation p_60718_) {
             return this.getBlock().rotate(this.asState(), p_60718_);
         }
@@ -597,6 +_,8 @@
         }
 
         public PushReaction getPistonPushReaction() {
+            PushReaction reaction = getBlock().getPistonPushReaction(asState());
+            if (reaction != null) return reaction;
             return this.pushReaction;
         }
 
@@ -724,6 +_,9 @@
         }
 
         public ItemInteractionResult useItemOn(ItemStack p_316374_, Level p_316651_, Player p_316623_, InteractionHand p_316469_, BlockHitResult p_316877_) {
+            var useOnContext = new net.minecraft.world.item.context.UseOnContext(p_316651_, p_316623_, p_316469_, p_316623_.getItemInHand(p_316469_).copy(), p_316877_);
+            var e = net.neoforged.neoforge.common.NeoForge.EVENT_BUS.post(new net.neoforged.neoforge.event.entity.player.UseItemOnBlockEvent(useOnContext, net.neoforged.neoforge.event.entity.player.UseItemOnBlockEvent.UsePhase.BLOCK));
+            if (e.isCanceled()) return e.getCancellationResult();
             return this.getBlock().useItemOn(p_316374_, this.asState(), p_316651_, p_316877_.getBlockPos(), p_316623_, p_316469_, p_316877_);
         }
 
@@ -825,6 +_,7 @@
             return this.getBlock().getSeed(this.asState(), p_60727_);
         }
 
+        @Deprecated //Forge: Use more sensitive version {@link IForgeBlockState#getSoundType(IWorldReader, BlockPos, Entity) }
         public SoundType getSoundType() {
             return this.getBlock().getSoundType(this.asState());
         }
@@ -859,11 +_,11 @@
             return this.instrument;
         }
 
-        static final class Cache {
+        public static final class Cache {
             private static final Direction[] DIRECTIONS = Direction.values();
             private static final int SUPPORT_TYPE_COUNT = SupportType.values().length;
             protected final boolean solidRender;
-            final boolean propagatesSkylightDown;
+            boolean propagatesSkylightDown;
             final int lightBlock;
             @Nullable
             final VoxelShape[] occlusionShapes;
@@ -959,11 +_,12 @@
         PushReaction pushReaction = PushReaction.NORMAL;
         boolean spawnTerrainParticles = true;
         NoteBlockInstrument instrument = NoteBlockInstrument.HARP;
+        private java.util.function.Supplier<ResourceKey<LootTable>> lootTableSupplier;
         boolean replaceable;
         BlockBehaviour.StateArgumentPredicate<EntityType<?>> isValidSpawn = (p_284893_, p_284894_, p_284895_, p_284896_) -> p_284893_.isFaceSturdy(
                     p_284894_, p_284895_, Direction.UP
                 )
-                && p_284893_.getLightEmission() < 14;
+                && p_284893_.getLightEmission(p_284894_, p_284895_) < 14;
         BlockBehaviour.StatePredicate isRedstoneConductor = (p_284888_, p_284889_, p_284890_) -> p_284888_.isCollisionShapeFullBlock(p_284889_, p_284890_);
         BlockBehaviour.StatePredicate isSuffocating = (p_284885_, p_284886_, p_284887_) -> p_284885_.blocksMotion()
                 && p_284885_.isCollisionShapeFullBlock(p_284886_, p_284887_);
@@ -1105,9 +_,15 @@
             return this;
         }
 
+        @Deprecated // FORGE: Use the variant that takes a Supplier below
         public BlockBehaviour.Properties dropsLike(Block p_60917_) {
-            this.drops = p_60917_.getLootTable();
+            this.lootTableSupplier = () -> p_60917_.getLootTable();
             return this;
+        }
+
+        public BlockBehaviour.Properties lootFrom(java.util.function.Supplier<? extends Block> blockIn) {
+             this.lootTableSupplier = () -> blockIn.get().getLootTable();
+             return this;
         }
 
         public BlockBehaviour.Properties ignitedByLava() {
