--- a/net/minecraft/world/level/block/entity/BeaconBlockEntity.java
+++ b/net/minecraft/world/level/block/entity/BeaconBlockEntity.java
@@ -18,7 +_,6 @@
 import net.minecraft.nbt.CompoundTag;
 import net.minecraft.network.chat.Component;
 import net.minecraft.network.protocol.game.ClientboundBlockEntityDataPacket;
-import net.minecraft.resources.ResourceKey;
 import net.minecraft.resources.ResourceLocation;
 import net.minecraft.server.level.ServerPlayer;
 import net.minecraft.sounds.SoundEvent;
@@ -39,11 +_,12 @@
 import net.minecraft.world.inventory.ContainerData;
 import net.minecraft.world.inventory.ContainerLevelAccess;
 import net.minecraft.world.level.Level;
-import net.minecraft.world.level.block.BeaconBeamBlock;
 import net.minecraft.world.level.block.Blocks;
 import net.minecraft.world.level.block.state.BlockState;
 import net.minecraft.world.level.levelgen.Heightmap;
 import net.minecraft.world.phys.AABB;
+import org.bukkit.craftbukkit.potion.CraftPotionUtil;
+import org.bukkit.potion.PotionEffect;
 
 public class BeaconBlockEntity extends BlockEntity implements MenuProvider, Nameable {
     private static final int MAX_LEVELS = 4;
@@ -137,8 +_,8 @@
 
         for (int i1 = 0; i1 < 10 && blockpos.getY() <= l; i1++) {
             BlockState blockstate = p_155108_.getBlockState(blockpos);
-            if (blockstate.getBlock() instanceof BeaconBeamBlock beaconbeamblock) {
-                int j1 = beaconbeamblock.getColor().getTextureDiffuseColor();
+            Integer j1 = blockstate.getBeaconColorMultiplier(p_155108_, blockpos, p_155109_);
+            if (j1 != null) {
                 if (p_155111_.checkingBeamSections.size() <= 1) {
                     beaconblockentity$beaconbeamsection = new BeaconBlockEntity.BeaconBeamSection(j1);
                     p_155111_.checkingBeamSections.add(beaconblockentity$beaconbeamsection);
@@ -173,11 +_,19 @@
             }
 
             if (p_155111_.levels > 0 && !p_155111_.beamSections.isEmpty()) {
-                applyEffects(p_155108_, p_155109_, p_155111_.levels, p_155111_.primaryPower, p_155111_.secondaryPower);
+                applyEffects(p_155108_, p_155109_, p_155111_.levels, p_155111_.primaryPower, p_155111_.secondaryPower, p_155111_);
                 playSound(p_155108_, p_155109_, SoundEvents.BEACON_AMBIENT);
             }
         }
-
+        // Paper start - beacon activation/deactivation events
+        if (k1 <= 0 && p_155111_.levels > 0) {
+            org.bukkit.block.Block block = org.bukkit.craftbukkit.block.CraftBlock.at(p_155108_, p_155109_);
+            new io.papermc.paper.event.block.BeaconActivatedEvent(block).callEvent();
+        } else if (k1 > 0 && p_155111_.levels <= 0) {
+            org.bukkit.block.Block block = org.bukkit.craftbukkit.block.CraftBlock.at(p_155108_, p_155109_);
+            new io.papermc.paper.event.block.BeaconDeactivatedEvent(block).callEvent();
+        }
+        // Paper end - beacon activation/deactivation events
         if (p_155111_.lastCheckY >= l) {
             p_155111_.lastCheckY = p_155108_.getMinBuildHeight() - 1;
             boolean flag = k1 > 0;
@@ -229,13 +_,26 @@
 
     @Override
     public void setRemoved() {
-        playSound(this.level, this.worldPosition, SoundEvents.BEACON_DEACTIVATE);
+        // Paper start - beacon activation/deactivation events
+        org.bukkit.block.Block block = org.bukkit.craftbukkit.block.CraftBlock.at(level, worldPosition);
+        new io.papermc.paper.event.block.BeaconDeactivatedEvent(block).callEvent();
+        // Paper end - beacon activation/deactivation events
+        // Paper start - fix MC-153086
+        if (this.levels > 0 && !this.beamSections.isEmpty()) {
+            playSound(this.level, this.worldPosition, SoundEvents.BEACON_DEACTIVATE);
+        }
+        // Paper end
         super.setRemoved();
     }
 
     private static void applyEffects(
         Level p_155098_, BlockPos p_155099_, int p_155100_, @Nullable Holder<MobEffect> p_316599_, @Nullable Holder<MobEffect> p_316343_
     ) {
+        // Paper start - Custom beacon ranges
+        applyEffects(p_155098_, p_155099_, p_155100_, p_316599_, p_316343_, null);
+    }
+    private static void applyEffects(Level p_155098_, BlockPos p_155099_, int p_155100_, @Nullable Holder<MobEffect> p_316599_, @Nullable Holder<MobEffect> p_316343_, @Nullable BeaconBlockEntity blockEntity) {
+        // Paper end - Custom beacon ranges
         if (!p_155098_.isClientSide && p_316599_ != null) {
             double d0 = (double)(p_155100_ * 10 + 10);
             int i = 0;
@@ -245,7 +_,7 @@
 
             int j = (9 + p_155100_ * 2) * 20;
             AABB aabb = new AABB(p_155099_).inflate(d0).expandTowards(0.0, (double)p_155098_.getHeight(), 0.0);
-            List<Player> list = p_155098_.getEntitiesOfClass(Player.class, aabb);
+            List<Player> list = getHumansInRange(p_155098_, p_155099_, p_155100_, blockEntity); // Paper - Custom beacon ranges
 
             for (Player player : list) {
                 player.addEffect(new MobEffectInstance(p_316599_, j, i, true, true));
@@ -286,7 +_,7 @@
     private static Holder<MobEffect> loadEffect(CompoundTag p_298570_, String p_299310_) {
         if (p_298570_.contains(p_299310_, 8)) {
             ResourceLocation resourcelocation = ResourceLocation.tryParse(p_298570_.getString(p_299310_));
-            return resourcelocation == null ? null : BuiltInRegistries.MOB_EFFECT.getHolder(resourcelocation).map(BeaconBlockEntity::filterEffect).orElse(null);
+            return resourcelocation == null ? null : BuiltInRegistries.MOB_EFFECT.getHolder(resourcelocation).orElse(null); // CraftBukkit - persist manually set non-default beacon effects (SPIGOT-3598)
         } else {
             return null;
         }
@@ -297,11 +_,13 @@
         super.loadAdditional(p_338669_, p_338291_);
         this.primaryPower = loadEffect(p_338669_, "primary_effect");
         this.secondaryPower = loadEffect(p_338669_, "secondary_effect");
+        this.levels = p_338669_.getInt("Levels"); // CraftBukkit - SPIGOT-5053, use where available
         if (p_338669_.contains("CustomName", 8)) {
             this.name = parseCustomNameSafe(p_338669_.getString("CustomName"), p_338291_);
         }
 
         this.lockKey = LockCode.fromTag(p_338669_);
+        this.effectRange = p_338669_.contains(PAPER_RANGE_TAG, 6) ? p_338669_.getDouble(PAPER_RANGE_TAG) : -1; // Paper - Custom beacon ranges
     }
 
     @Override
@@ -315,6 +_,7 @@
         }
 
         this.lockKey.addToTag(p_187463_);
+        p_187463_.putDouble(PAPER_RANGE_TAG, this.effectRange); // Paper - Custom beacon ranges
     }
 
     public void setCustomName(@Nullable Component p_58682_) {
@@ -330,7 +_,7 @@
     @Nullable
     @Override
     public AbstractContainerMenu createMenu(int p_58696_, Inventory p_58697_, Player p_58698_) {
-        return BaseContainerBlockEntity.canUnlock(p_58698_, this.lockKey, this.getDisplayName())
+        return BaseContainerBlockEntity.canUnlock(p_58698_, this.lockKey, this.getDisplayName(), this)
             ? new BeaconMenu(p_58696_, p_58697_, this.dataAccess, ContainerLevelAccess.create(this.level, this.getBlockPos()))
             : null;
     }
@@ -393,5 +_,81 @@
         public int getHeight() {
             return this.height;
         }
+    }
+
+    // CraftBukkit start - add fields and methods
+    public PotionEffect getPrimaryEffect() {
+        return (this.primaryPower != null) ? CraftPotionUtil.toBukkit(new MobEffectInstance(this.primaryPower, getLevel(this.levels), getAmplification(levels, primaryPower, secondaryPower), true, true)) : null;
+    }
+
+    public PotionEffect getSecondaryEffect() {
+        return (hasSecondaryEffect(levels, primaryPower, secondaryPower)) ? CraftPotionUtil.toBukkit(new MobEffectInstance(this.secondaryPower, getLevel(this.levels), getAmplification(levels, primaryPower, secondaryPower), true, true)) : null;
+    }
+    // CraftBukkit end
+    // Paper start - Custom beacon ranges
+    private final String PAPER_RANGE_TAG = "Paper.Range";
+    private double effectRange = -1;
+
+    public double getEffectRange() {
+        if (this.effectRange < 0) {
+            return this.levels * 10 + 10;
+        } else {
+            return effectRange;
+        }
+    }
+
+    public void setEffectRange(double range) {
+        this.effectRange = range;
+    }
+
+    public void resetEffectRange() {
+        this.effectRange = -1;
+    }
+    // Paper end - Custom beacon ranges
+
+    public static List getHumansInRange(Level world, BlockPos blockposition, int i) {
+        // Paper start - Custom beacon ranges
+        return BeaconBlockEntity.getHumansInRange(world, blockposition, i, null);
+    }
+    public static List getHumansInRange(Level world, BlockPos blockposition, int i, @Nullable BeaconBlockEntity blockEntity) {
+        // Paper end - Custom beacon ranges
+        double d0 = (double) (i * 10 + 10);
+        AABB axisalignedbb = (new AABB(blockposition)).inflate(d0).expandTowards(0.0D, (double) world.getHeight(), 0.0D);
+        // Paper start - Perf: optimize player lookup for beacons
+        List<Player> list;
+        if (d0 <= 128.0) {
+            list = world.getEntitiesOfClass(Player.class, axisalignedbb);
+        } else {
+            list = new java.util.ArrayList<>();
+            for (Player player : world.players()) {
+                if (player.isSpectator()) {
+                    continue;
+                }
+                if (player.getBoundingBox().intersects(axisalignedbb)) {
+                    list.add(player);
+                }
+            }
+        }
+        // Paper end - Perf: optimize player lookup for beacons
+        return list;
+    }
+
+    private static byte getAmplification(int i, @Nullable Holder<MobEffect> holder, @Nullable Holder<MobEffect> holder1) {
+        byte b0 = 0;
+        if (i >= 4 && Objects.equals(holder, holder1)) {
+            b0 = 1;
+        }
+        return b0;
+    }
+
+    private static boolean hasSecondaryEffect(int i, @Nullable Holder<MobEffect> holder, @Nullable Holder<MobEffect> holder1) {
+        if (i >= 4 && !Objects.equals(holder, holder1) && holder1 != null) {
+            return true;
+        }
+        return false;
+    }
+
+    private static int getLevel(int i) {
+        return  (9 + i * 2) * 20;
     }
 }
