--- a/net/minecraft/world/level/levelgen/structure/StructurePiece.java
+++ b/net/minecraft/world/level/levelgen/structure/StructurePiece.java
@@ -11,7 +_,6 @@
 import net.minecraft.core.registries.BuiltInRegistries;
 import net.minecraft.nbt.CompoundTag;
 import net.minecraft.nbt.NbtOps;
-import net.minecraft.nbt.Tag;
 import net.minecraft.resources.ResourceKey;
 import net.minecraft.util.RandomSource;
 import net.minecraft.world.level.BlockGetter;
@@ -28,7 +_,6 @@
 import net.minecraft.world.level.block.Rotation;
 import net.minecraft.world.level.block.entity.BlockEntity;
 import net.minecraft.world.level.block.entity.ChestBlockEntity;
-import net.minecraft.world.level.block.entity.DispenserBlockEntity;
 import net.minecraft.world.level.block.state.BlockState;
 import net.minecraft.world.level.chunk.ChunkGenerator;
 import net.minecraft.world.level.levelgen.Heightmap;
@@ -36,6 +_,14 @@
 import net.minecraft.world.level.levelgen.structure.pieces.StructurePieceType;
 import net.minecraft.world.level.material.FluidState;
 import net.minecraft.world.level.storage.loot.LootTable;
+import org.bukkit.craftbukkit.CraftLootTable;
+import org.bukkit.craftbukkit.block.CraftBlockEntityState;
+import org.bukkit.craftbukkit.block.CraftBlockState;
+import org.bukkit.craftbukkit.block.CraftBlockStates;
+import org.bukkit.craftbukkit.block.CraftChest;
+import org.bukkit.craftbukkit.block.CraftCreatureSpawner;
+import org.bukkit.craftbukkit.block.CraftDispenser;
+import org.bukkit.craftbukkit.util.TransformerGeneratorAccess;
 import org.slf4j.Logger;
 
 public abstract class StructurePiece {
@@ -91,6 +_,9 @@
     }
 
     public final CompoundTag createTag(StructurePieceSerializationContext p_192645_) {
+        if (BuiltInRegistries.STRUCTURE_PIECE.getKey(this.getType()) == null) { // FORGE: Friendlier error then the Null String error below.
+            throw new RuntimeException("StructurePiece \"" + this.getClass().getName() + "\": \"" + this.getType() + "\" unregistered, serializing impossible.");
+        }
         CompoundTag compoundtag = new CompoundTag();
         compoundtag.putString("id", BuiltInRegistries.STRUCTURE_PIECE.getKey(this.getType()).toString());
         BoundingBox.CODEC
@@ -200,6 +_,11 @@
                 }
 
                 p_73435_.setBlock(blockpos, p_73436_, 2);
+                // CraftBukkit start - fluid handling is already done if we have a transformer generator access
+                if (p_73435_ instanceof TransformerGeneratorAccess) {
+                    return;
+                }
+                // CraftBukkit end
                 FluidState fluidstate = p_73435_.getFluidState(blockpos);
                 if (!fluidstate.isEmpty()) {
                     p_73435_.scheduleTick(blockpos, fluidstate.getType(), 0);
@@ -212,6 +_,38 @@
         }
     }
 
+    // CraftBukkit start
+    protected boolean placeCraftBlockEntity(ServerLevelAccessor worldAccess, BlockPos position, CraftBlockEntityState<?> craftBlockEntityState, int i) {
+        if (worldAccess instanceof TransformerGeneratorAccess transformerAccess) {
+            return transformerAccess.setCraftBlock(position, craftBlockEntityState, i);
+        }
+        boolean result = worldAccess.setBlock(position, craftBlockEntityState.getHandle(), i);
+        BlockEntity tileEntity = worldAccess.getBlockEntity(position);
+        if (tileEntity != null) {
+            tileEntity.loadWithComponents(craftBlockEntityState.getSnapshotNBT(), worldAccess.registryAccess());
+        }
+        return result;
+    }
+
+    protected void placeCraftSpawner(ServerLevelAccessor worldAccess, BlockPos position, org.bukkit.entity.EntityType entityType, int i) {
+        // This method is used in structures that are generated by code and place spawners as they set the entity after the block was placed making it impossible for plugins to access that information
+        CraftCreatureSpawner spawner = (CraftCreatureSpawner) CraftBlockStates.getBlockState(worldAccess, position, Blocks.SPAWNER.defaultBlockState(), null);
+        spawner.setSpawnedType(entityType);
+        placeCraftBlockEntity(worldAccess, position, spawner, i);
+    }
+
+    protected void setCraftLootTable(ServerLevelAccessor worldAccess, BlockPos position, RandomSource randomSource, ResourceKey<LootTable> loottableKey) {
+        // This method is used in structures that use data markers to a loot table to loot containers as otherwise plugins won't have access to that information.
+        BlockEntity tileEntity = worldAccess.getBlockEntity(position);
+        if (tileEntity instanceof net.minecraft.world.level.block.entity.RandomizableContainerBlockEntity tileEntityLootable) {
+            tileEntityLootable.setLootTable(loottableKey, randomSource.nextLong());
+            if (worldAccess instanceof TransformerGeneratorAccess transformerAccess) {
+                transformerAccess.setCraftBlock(position, (CraftBlockState) CraftBlockStates.getBlockState(worldAccess, position, tileEntity.getBlockState(), tileEntityLootable.saveWithFullMetadata(worldAccess.registryAccess())), 3);
+            }
+        }
+    }
+    // CraftBukkit end
+
     protected boolean canBeReplaced(LevelReader p_163553_, int p_163554_, int p_163555_, int p_163556_, BoundingBox p_163557_) {
         return true;
     }
@@ -527,13 +_,23 @@
     ) {
         BlockPos blockpos = this.getWorldPos(p_226823_, p_226824_, p_226825_);
         if (p_226821_.isInside(blockpos) && !p_226820_.getBlockState(blockpos).is(Blocks.DISPENSER)) {
-            this.placeBlock(
-                p_226820_, Blocks.DISPENSER.defaultBlockState().setValue(DispenserBlock.FACING, p_226826_), p_226823_, p_226824_, p_226825_, p_226821_
-            );
-            BlockEntity blockentity = p_226820_.getBlockEntity(blockpos);
-            if (blockentity instanceof DispenserBlockEntity) {
-                ((DispenserBlockEntity)blockentity).setLootTable(p_336026_, p_226822_.nextLong());
-            }
+            // CraftBukkit start
+            if (!this.canBeReplaced(p_226820_, p_226823_, p_226824_, p_226825_, p_226821_)) {
+                return true;
+            }
+            BlockState iblockdata = Blocks.DISPENSER.defaultBlockState().setValue(DispenserBlock.FACING, p_226826_);
+            if (this.mirror != Mirror.NONE) {
+                iblockdata = iblockdata.mirror(this.mirror);
+            }
+            if (this.rotation != Rotation.NONE) {
+                iblockdata = iblockdata.rotate(this.rotation);
+            }
+
+            CraftDispenser dispenserState = (CraftDispenser) CraftBlockStates.getBlockState(p_226820_, blockpos, iblockdata, null);
+            dispenserState.setLootTable(CraftLootTable.minecraftToBukkit(p_336026_));
+            dispenserState.setSeed(p_226822_.nextLong());
+            placeCraftBlockEntity(p_226820_, blockpos, dispenserState, 2);
+            // CraftBukkit end
 
             return true;
         } else {
